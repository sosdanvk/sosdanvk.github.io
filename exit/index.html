<!doctype html>
<html>
<!--
 __     __  _    _   _  __  _____       _   _   __   
 \ \   / / | |  | | | |/ / |_   _|     | \ | |  \ \  
  \ \_/ /  | |  | | | ' /    | |       |  \| |   \ \ 
   \   /   | |  | | |  <     | |       | . ` |    > >
    | |    | |__| | | . \   _| |_   _  | |\  |   / / 
    |_|     \____/  |_|\_\ |_____| (_) |_| \_|  /_/  

    vk.com/sosdan
-->

<head>
    <meta charset="utf-8">
    <title>Emergency Escape Program</title>
    <link rel="icon" href="./favicon.ico" type="image/x-icon">
    <script>
        var curLoc = new URL(window.location.href);
        window.mobilecheck = function() {
            var check = false;
            if (navigator.userAgent.match(/Android/i) || navigator.userAgent.match(/webOS/i) || navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPad/i) || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/BlackBerry/i) || navigator.userAgent.match(/Windows Phone/i)) check = true;
            if(curLoc.searchParams.get("mobile")) check = true;
            return check;
        };
        var lang = "en";
        var started = false;
        var ended = false;
        var curTd = 0;
        var curLe = 0;
        
        document.addEventListener("DOMContentLoaded", function(event) {
            if (curLoc.searchParams.get("lang")) lang = curLoc.searchParams.get("lang");
        else if (navigator.language) lang = navigator.language.split('-')[0];
            var s = document.createElement("script");
            s.src = "./lang/" + lang + ".js";
            //debugger;
            s.onload = function() {
                start();
            }
            s.onerror = function() {
                s.src = "./lang/en.js";
            }
            document.body.appendChild(s);
        });

        function printLe() {
            let tds = document.getElementsByTagName("td");
            if (curTd < p.length) {

                let cursor = "_";

                if (curLe < p[curTd].length) {
                    if (" -".indexOf(p[curTd][curLe]) > -1)
                        cursor = "<wbr>_<wbr>";
                    if (p[curTd][curLe] == "\n")
                        cursor = "<br><wbr>_<wbr>";
                    if (p[curTd]==" ") cursor = " ";
                    let text = "";
                    text = p[curTd].slice(0, curLe).replace(/\n/g, "<br>")
                        + cursor
                        + "<span class='invisible'>"
                        + p[curTd].slice(curLe).slice(1).replace(/\n/g, "<br>")
                        + "</span>";
                    tds[curTd].innerHTML = text;
                    curLe++;
                } else {
                    curLe = 0;
                    curTd++;
                }
                if (curTd % 2 == 0 && curLe == 0) {
                    if (curTd > 0) tds[curTd - 1].innerHTML = p[curTd - 1].replace(/\n/g, "<br>") + "<span class='blink'><wbr>_</span>";
                    setTimeout(printLe, 4000/*speed * 50*/);
                } else {
                    if (curTd > 0) tds[curTd - 1].innerHTML = p[curTd - 1].replace(/\n/g, "<br>") + "<br><br>";
                    setTimeout(printLe, speed);
                }
            } else {
                tds[curTd - 1].innerHTML = p[curTd - 1].replace(/\n/g, "<br>") + "<span class='blink'><wbr>_</span>";
                if (window.mobilecheck()) document.getElementById("buttons").style.display = "block";
                else end();
            }
            window.scrollTo(0, document.body.scrollHeight);
        }

        function start() {
            if (!started) {
                let table = '<table><tr><td><span class="blink"><wbr>_</span></td><td></td></tr>';
                for (let i = 0; i < (p.length / 2) - 1; i++) {
                    table += '<tr><td></td><td></td></tr>';
                }
                table += '</table>';
                document.getElementById("console").innerHTML = table;
                setTimeout(printLe, 5000/*speed * 63*/);
                started = true;
            }
        }
        function end() {
            document.body.addEventListener("keydown", function (e) {
                if(!ended) {
                    if (e.keyCode == 13) {
                        play("enter");
                    } else {
                        play("n");
                    }
                }
                ended = true;
            });
        }
        function play(file) {
            let html = "<video autoplay='autoplay' controls='no'>";
            html += "<source src='./media/"+file+".webm'>";
            html += "<source src='./media/"+file+".mp4'>";
            html += "<img src='./media/"+file+".gif'>";
            html += "</video>";
            document.body.innerHTML = html;
        }
    </script>
    <style>
        html {
            overflow-y:scroll;
        }
        body {
            background-color: rgba(12, 12, 12, 1);
            color: rgba(204, 204, 204, 1);
            font-family: Consolas, "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", Monaco, "Courier New", "monospace";
            
        }
        video {width: 99%; height: 99%;}
        img {max-width: 99%; max-height: 99%;}
        #buttons {
            display: none;
            position: fixed;
            bottom: 15px;
            text-align: center;
            width: 99%;
        }
        
        button {
            width: 45%;
            height: 30px;
        }
        
        td {
            vertical-align: top;
        }
        
        td:first-child {
            white-space: nowrap;
        }
        
        td {
            word-wrap: break-word;
        }
        
        .blink {
            animation: blink-animation 0.9s steps(5, start) infinite;
        }
        
        @keyframes blink-animation {
            to {
                visibility: hidden;
            }
        }
        
        .invisible {
            color: rgba(12, 12, 12, 1);
            color: transparent;
        }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no, viewport-fit=cover">
</head>

<body>
    <div style="display: none;">
        <video preload="auto">
            <source src="./media/enter.webm">
            <source src="./media/enter.mp4">
        </video>
        <video preload="auto">
            <source src="./media/n.webm">
            <source src="./media/n.mp4">
        </video>
    </div>
    <div id="console">
        <table><tr><td><span class="blink">&shy;_</span></td><td></td></tr></table>
    </div>
    <div style="height:  55px;"></div>
    <div id="buttons">
        <button onClick="play('enter');">Enter</button>
        <button onClick="play('n');">N</button>
    </div>
</body>

</html>